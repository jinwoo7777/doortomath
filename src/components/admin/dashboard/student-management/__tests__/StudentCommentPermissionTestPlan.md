# 학생 코멘트 기능 권한 테스트 계획

이 문서는 학생 코멘트 기능의 권한 테스트를 위한 계획을 제공합니다. 관리자, 강사, 학생 등 다양한 역할에 따른 권한 제한이 올바르게 적용되는지 검증합니다.

## 1. 데이터베이스 RLS 정책 테스트

### 1.1 관리자 권한 테스트
- **테스트 대상**: `admin_all` 정책
- **테스트 방법**: 
  - 관리자 계정으로 로그인
  - 모든 학생의 코멘트 조회, 추가, 수정, 삭제 시도
- **예상 결과**: 
  - 모든 작업이 성공적으로 수행됨
  - 모든 학생의 코멘트에 접근 가능

### 1.2 강사 권한 테스트
- **테스트 대상**: `instructor_own_courses` 정책
- **테스트 방법**:
  - 강사 계정으로 로그인
  - 자신이 담당하는 강의의 학생 코멘트 조회, 추가, 수정, 삭제 시도
  - 담당하지 않는 강의의 학생 코멘트 조회, 추가, 수정, 삭제 시도
- **예상 결과**:
  - 자신이 담당하는 강의의 학생 코멘트만 접근 가능
  - 담당하지 않는 강의의 학생 코멘트에는 접근 불가

### 1.3 학생 권한 테스트
- **테스트 대상**: RLS 정책 전체
- **테스트 방법**:
  - 학생 계정으로 로그인
  - 코멘트 조회, 추가, 수정, 삭제 시도
- **예상 결과**:
  - 모든 작업이 거부됨
  - 권한 없음 오류 발생

## 2. API 엔드포인트 권한 테스트

### 2.1 코멘트 조회 API 권한 테스트
- **테스트 대상**: `GET /api/admin/students/comments`
- **테스트 방법**:
  - 관리자, 강사, 학생 계정으로 각각 API 호출
  - 인증되지 않은 상태로 API 호출
- **예상 결과**:
  - 관리자: 모든 학생의 코멘트 조회 가능
  - 강사: 자신이 담당하는 강의의 학생 코멘트만 조회 가능
  - 학생: 접근 거부 (403 Forbidden)
  - 인증되지 않음: 인증 오류 (401 Unauthorized)

### 2.2 코멘트 추가 API 권한 테스트
- **테스트 대상**: `POST /api/admin/students/comments`
- **테스트 방법**:
  - 관리자, 강사, 학생 계정으로 각각 API 호출
  - 인증되지 않은 상태로 API 호출
- **예상 결과**:
  - 관리자: 모든 학생에 대한 코멘트 추가 가능
  - 강사: 자신이 담당하는 강의의 학생에 대한 코멘트만 추가 가능
  - 학생: 접근 거부 (403 Forbidden)
  - 인증되지 않음: 인증 오류 (401 Unauthorized)

### 2.3 코멘트 삭제 API 권한 테스트
- **테스트 대상**: `DELETE /api/admin/students/comments/[id]`
- **테스트 방법**:
  - 관리자, 강사, 학생 계정으로 각각 API 호출
  - 인증되지 않은 상태로 API 호출
  - 강사가 자신이 작성한 코멘트와 다른 강사가 작성한 코멘트 삭제 시도
- **예상 결과**:
  - 관리자: 모든 코멘트 삭제 가능
  - 강사: 자신이 작성한 코멘트 또는 자신이 담당하는 강의의 코멘트만 삭제 가능
  - 학생: 접근 거부 (403 Forbidden)
  - 인증되지 않음: 인증 오류 (401 Unauthorized)

## 3. UI 컴포넌트 권한 테스트

### 3.1 코멘트 모달 접근 권한 테스트
- **테스트 대상**: `StudentCommentModal` 컴포넌트
- **테스트 방법**:
  - 관리자, 강사, 학생 계정으로 각각 로그인
  - 학생 목록에서 코멘트 아이콘 클릭 시도
- **예상 결과**:
  - 관리자: 모든 학생의 코멘트 모달 접근 가능
  - 강사: 자신이 담당하는 강의의 학생 코멘트 모달만 접근 가능
  - 학생: 코멘트 아이콘이 표시되지 않거나 접근 불가

### 3.2 코멘트 삭제 버튼 표시 권한 테스트
- **테스트 대상**: 코멘트 삭제 버튼
- **테스트 방법**:
  - 관리자, 강사 계정으로 각각 로그인
  - 코멘트 모달에서 삭제 버튼 표시 여부 확인
- **예상 결과**:
  - 관리자: 모든 코멘트에 대한 삭제 버튼 표시
  - 강사: 자신이 작성한 코멘트 또는 자신이 담당하는 강의의 코멘트에만 삭제 버튼 표시

## 4. 테스트 시나리오

### 4.1 관리자 권한 시나리오
1. 관리자로 로그인
2. 학생 목록에서 임의의 학생 선택
3. 코멘트 모달 열기
4. 코멘트 추가, 조회, 삭제 시도
5. 모든 작업이 성공적으로 수행되는지 확인

### 4.2 강사 권한 시나리오 - 담당 학생
1. 강사로 로그인
2. 자신이 담당하는 강의의 학생 선택
3. 코멘트 모달 열기
4. 코멘트 추가, 조회, 삭제 시도
5. 모든 작업이 성공적으로 수행되는지 확인

### 4.3 강사 권한 시나리오 - 비담당 학생
1. 강사로 로그인
2. 자신이 담당하지 않는 강의의 학생 선택
3. 코멘트 모달 열기 시도
4. 접근이 거부되는지 확인

### 4.4 학생 권한 시나리오
1. 학생으로 로그인
2. 학생 목록 페이지 접근 시도
3. 접근이 거부되는지 확인

## 5. 자동화된 테스트

### 5.1 API 권한 테스트 자동화
- Jest를 사용하여 API 엔드포인트의 권한 검사 로직 테스트
- 다양한 역할의 사용자 세션을 모의(mock)하여 테스트

### 5.2 UI 권한 테스트 자동화
- React Testing Library를 사용하여 UI 컴포넌트의 권한 기반 렌더링 테스트
- 다양한 역할의 사용자 컨텍스트를 모의하여 테스트

### 5.3 E2E 권한 테스트 자동화
- Cypress를 사용하여 실제 사용자 시나리오 테스트
- 다양한 역할의 사용자로 로그인하여 전체 흐름 테스트

## 6. 테스트 결과 기록

각 테스트 케이스에 대해 다음 정보를 기록합니다:

- 테스트 날짜 및 시간
- 테스트 계정 정보 (역할)
- 테스트 결과 (성공/실패)
- 발견된 문제점
- 스크린샷 또는 로그 (필요한 경우)

## 7. 보안 취약점 추적

테스트 중 발견된 보안 취약점을 기록하고 우선순위를 지정합니다:

- 심각: 권한 우회가 가능한 취약점
- 높음: 권한 검사가 불완전한 취약점
- 중간: 권한 오류 메시지가 과도한 정보를 노출하는 경우
- 낮음: 기타 경미한 보안 문제